<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>JSON ç”¢ç”Ÿå™¨ - æµç¨‹è¡Œç¨‹</title>
<style>
    body {
        font-family: system-ui, -apple-system;
        background: #111;
        color: #fff;
        padding: 20px;
        line-height: 1.6;
    }

    h1 {
        margin-bottom: 20px;
        font-size: 26px;
        text-align: center;
    }

    .flow-card {
        background: #1b1b1b;
        padding: 16px;
        border-radius: 12px;
        border: 1px solid #333;
        margin-bottom: 20px;
    }

    label {
        font-size: 13px;
        color: #ccc;
    }

    input, textarea, select {
        width: 100%;
        padding: 8px;
        margin-top: 4px;
        margin-bottom: 12px;
        background: #222;
        border: 1px solid #444;
        border-radius: 6px;
        color: #fff;
    }

    textarea {
        height: 70px;
    }

    button {
        padding: 10px 18px;
        background: #ff5555;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-right: 8px;
        margin-top: 8px;
        font-weight: bold;
    }

    button:hover {
        background: #ff7777;
    }

    .steps-area {
        background: #222;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #444;
        margin-bottom: 12px;
    }

    .step-item {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
    }

    .step-item input {
        flex: 1;
    }

    pre {
        background: #000;
        color: #0f0;
        padding: 16px;
        border-radius: 8px;
        margin-top: 20px;
        white-space: pre-wrap;
    }

</style>
</head>
<body>

<h1>æµç¨‹ JSON è‡ªå‹•ç”¢ç”Ÿå™¨</h1>

<div id="flows"></div>

<button onclick="addFlow()">ï¼‹ æ–°å¢æµç¨‹</button>
<button onclick="generateJSON()">ç”¢ç”Ÿ JSON</button>

<h2>è¼¸å‡º JSON</h2>
<button onclick="copyJSON()">ğŸ“‹ è¤‡è£½ JSON</button>
<pre id="output">{}</pre>

<script>
let flows = JSON.parse(localStorage.getItem("flows-maker") || "[]");
const flowsDiv = document.getElementById("flows");

function save() {
    localStorage.setItem("flows-maker", JSON.stringify(flows));
}

function render() {
    flowsDiv.innerHTML = "";
    flows.forEach((flow, index) => {
        const card = document.createElement("div");
        card.className = "flow-card";

        card.innerHTML = `
            <label>æµç¨‹æ¨™é¡Œ</label>
            <input value="${flow.title}" onchange="updateFlow(${index}, 'title', this.value)">

            <label>æµç¨‹èªªæ˜</label>
            <textarea onchange="updateFlow(${index}, 'description', this.value)">${flow.description}</textarea>

            <label>é–‹å§‹æ—¥æœŸ</label>
            <input type="date" value="${flow.startDate}" onchange="updateFlow(${index}, 'startDate', this.value)">

            <label>çµæŸæ—¥æœŸ</label>
            <input type="date" value="${flow.endDate}" onchange="updateFlow(${index}, 'endDate', this.value)">

            <label>æµç¨‹æ­¥é©Ÿ</label>

            <div class="steps-area" id="steps-${index}">
            </div>

            <button onclick="addStep(${index})">ï¼‹ æ–°å¢æ­¥é©Ÿ</button>

            <label>ç›®å‰é€²åº¦ (0 = ç¬¬ä¸€æ­¥)</label>
            <input type="number" min="0" value="${flow.progress.currentStep}" 
                   onchange="updateCurrentStep(${index}, this.value)">
            
            <button onclick="removeFlow(${index})">ğŸ—‘ åˆªé™¤æµç¨‹</button>
        `;

        flowsDiv.appendChild(card);
        renderSteps(index);
    });
}

function addFlow() {
    flows.push({
        id: "flow-" + Date.now(),
        title: "",
        description: "",
        startDate: "",
        endDate: "",
        progress: {
            steps: ["é–‹å§‹", "çµæŸ"],
            currentStep: 0
        }
    });
    save();
    render();
}

function removeFlow(index) {
    flows.splice(index, 1);
    save();
    render();
}

function updateFlow(index, field, value) {
    flows[index][field] = value;
    save();
}

function addStep(flowIndex) {
    flows[flowIndex].progress.steps.push("");
    save();
    renderSteps(flowIndex);
}

function updateStep(flowIndex, stepIndex, value) {
    flows[flowIndex].progress.steps[stepIndex] = value;
    save();
}

function updateCurrentStep(flowIndex, value) {
    flows[flowIndex].progress.currentStep = Number(value);
    save();
}

function renderSteps(flowIndex) {
    const stepsDiv = document.getElementById(`steps-${flowIndex}`);
    stepsDiv.innerHTML = "";

    flows[flowIndex].progress.steps.forEach((step, stepIndex) => {
        const div = document.createElement("div");
        div.className = "step-item";
        div.innerHTML = `
            <input value="${step}" placeholder="æ­¥é©Ÿåç¨±"
                   onchange="updateStep(${flowIndex}, ${stepIndex}, this.value)">
            <button onclick="deleteStep(${flowIndex}, ${stepIndex})">X</button>
        `;
        stepsDiv.appendChild(div);
    });
}

function deleteStep(flowIndex, stepIndex) {
    flows[flowIndex].progress.steps.splice(stepIndex, 1);
    save();
    renderSteps(flowIndex);
}

function generateJSON() {
    const result = {
        flows: flows
    };
    document.getElementById("output").textContent = JSON.stringify(result, null, 4);
}

function copyJSON() {
    const text = document.getElementById("output").textContent;
    navigator.clipboard.writeText(text);
    alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
}

render();

</script>

</body>
</html>
